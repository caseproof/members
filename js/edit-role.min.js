jQuery(document).ready(function(){function r(e){e=e.toLowerCase().trim().replace(/<.*?>/g,"").replace(/\s/g,"_").replace(/[^a-zA-Z0-9_]/g,""),jQuery(".role-slug").text(e)}jQuery(".members-delete-role-link").on("click",function(){return window.confirm(members_i18n.ays_delete_role)}),jQuery('input[name="role_name"]').keyup(function(){jQuery('input[name="role"]').val()||r(this.value)}),jQuery('input[name="role"], .role-ok-button').hide(),jQuery(document).on("click",".role-edit-button.closed",function(){jQuery(this).removeClass("closed").addClass("open").text(members_i18n.button_role_ok),jQuery('input[name="role"]').show(),jQuery('input[name="role"]').trigger("focus"),jQuery('input[name="role"]').attr("value",jQuery(".role-slug").text())}),jQuery(document).on("click",".role-edit-button.open",function(){jQuery(this).removeClass("open").addClass("closed").text(members_i18n.button_role_edit),jQuery('input[name="role"]').hide();var e=jQuery('input[name="role"]').val();r(e||jQuery('input[name="role_name"]').val())}),jQuery('input[name="role"]').keypress(function(e){if(13===e.keyCode)return jQuery(".role-edit-button").click().trigger("focus"),e.preventDefault(),!1}),jQuery('.users_page_role-new input[name="role_name"]').val()||jQuery(".users_page_role-new #publish").prop("disabled",!0),jQuery('.users_page_role-new input[name="role_name"]').on("input",function(){jQuery(this).val()?jQuery(".users_page_role-new #publish").prop("disabled",!1):jQuery(".users_page_role-new #publish").prop("disabled",!0)});var t=wp.template("members-cap-section"),a=wp.template("members-cap-control");function u(){var e=jQuery("#members-tab-all input[data-grant-cap]:checked").length,r=jQuery("#members-tab-all input[data-deny-cap]:checked").length,t=jQuery('#members-tab-custom input[name="grant-new-caps[]"]:checked').length,a=jQuery('#members-tab-custom input[name="deny-new-caps[]"]:checked').length;jQuery("#submitdiv .granted-count").text(e+t),jQuery("#submitdiv .denied-count").text(r+a)}function s(e){var r="grant",t="deny",a=(jQuery(e).attr("data-deny-cap")&&(r="deny",t="grant"),jQuery(e).attr("data-"+r+"-cap"));(jQuery(e).prop("checked")?(jQuery("input[data-"+r+'-cap="'+a+'"]').not(e).prop("checked",!0),jQuery("input[data-"+t+'-cap="'+a+'"]')):jQuery("input[data-"+r+'-cap="'+a+'"]').not(e)).prop("checked",!1)}"undefined"!=typeof members_sections&&"undefined"!=typeof members_controls&&(_.each(members_sections,function(e){jQuery(".members-tab-wrap").append(t(e))}),_.each(members_controls,function(e){jQuery("#members-tab-"+e.section+" tbody").append(a(e))})),jQuery(".members-cap-tabs .members-tab-content").hide(),jQuery(".members-cap-tabs .members-tab-content:first-child").show(),jQuery(".members-tab-nav :first-child").attr("aria-selected","true"),jQuery(".members-which-tab").text(jQuery(".members-tab-nav :first-child a").text()),jQuery(".members-tab-nav li a").on("click",function(e){e.preventDefault();e=jQuery(this).attr("href");jQuery(this).parents(".members-cap-tabs").find(".members-tab-content").hide(),jQuery(this).parents(".members-cap-tabs").find(e).show(),jQuery(this).parents(".members-cap-tabs").find(".members-tab-title").attr("aria-selected","false"),jQuery(this).parent().attr("aria-selected","true"),jQuery(".members-which-tab").text(jQuery(this).text())}),u(),jQuery(document).on("change",".members-cap-checklist input[data-grant-cap], .members-cap-checklist input[data-deny-cap]",function(){s(this),u()}),jQuery(document).on("change",".members-roles-select input.check-all-grant, .members-roles-select input.check-all-deny",function(){var e=jQuery(this),r=e.is(":checked"),t=e.hasClass("check-all-grant"),e=e.closest(".members-roles-select"),a=e.find("tbody input[data-grant-cap]"),n=e.find("tbody input[data-deny-cap]"),c=e.find("input.check-all-deny"),e=e.find("input.check-all-grant");t?_.each(a,function(e){e.checked=r,s(e)}):_.each(n,function(e){e.checked=r,s(e)}),(r?t?(e.prop("checked",!0),c):(c.prop("checked",!0),e):t?e:c).prop("checked",!1),u()}),jQuery(document).on("click",".editable-role .members-cap-checklist button",function(){var e=jQuery(this).closest(".members-cap-checklist"),r=jQuery(e).find("input[data-grant-cap]"),e=jQuery(e).find("input[data-deny-cap]");(jQuery(r).prop("checked")?(jQuery(r).prop("checked",!1),jQuery(e).prop("checked",!0)):jQuery(e).prop("checked")?(jQuery(r).prop("checked",!1),jQuery(e).prop("checked",!1)):jQuery(r).prop("checked",!0)).change()}),jQuery(document).on("mouseenter",".editable-role .members-cap-checklist button",function(){jQuery(".members-cap-checklist button:focus").not(this).blur()}),postboxes.add_postbox_toggles(pagenow),jQuery("#newcapdiv button.handlediv").attr("type","button"),jQuery("#members-add-new-cap").prop("disabled",!0),jQuery("#members-new-cap-field").on("input",function(){-1===jQuery.inArray(jQuery(this).val(),members_i18n.hidden_caps)?jQuery("#members-add-new-cap").prop("disabled",!1):jQuery("#members-add-new-cap").prop("disabled",!0)}),jQuery("#members-new-cap-field").keypress(function(e){if(13===e.keyCode)return jQuery("#members-add-new-cap").click(),e.preventDefault(),!1}),jQuery("#members-add-new-cap").on("click",function(){var e,r,t=jQuery("#members-new-cap-field").val();(t=t.trim().replace(/<.*?>/g,"").replace(/\s/g,"_").replace(/[^a-zA-Z0-9_]/g,""))&&-1===jQuery.inArray(jQuery(this).val(),members_i18n.hidden_caps)&&(jQuery('a[href="#members-tab-custom"]').trigger("click"),members_i18n.label_grant_cap=members_i18n.label_grant_cap.replace(/%s/g,"<code>"+t+"</code>"),members_i18n.label_deny_cap=members_i18n.label_deny_cap.replace(/%s/g,"<code>"+t+"</code>"),e={cap:t,readonly:"",name:{grant:"grant-new-caps[]",deny:"deny-new-caps[]"},is_granted_cap:!0,is_denied_cap:!1,label:{cap:t,grant:members_i18n.label_grant_cap,deny:members_i18n.label_deny_cap}},jQuery("#members-tab-custom tbody").prepend(a(e)),r=jQuery('[data-grant-cap="'+t+'"]').parents(".members-cap-checklist"),jQuery(r).addClass("members-highlight"),setTimeout(function(){jQuery(r).removeClass("members-highlight")},500),jQuery("#members-new-cap-field").val(""),jQuery("#members-add-new-cap").prop("disabled",!0),jQuery('.members-cap-checklist input[data-grant-cap="'+t+'"]').trigger("change"))})});